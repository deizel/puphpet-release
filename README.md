# puphpet-release

Makes an unpacked version of the vagrant environment generated by puphpet.com available via composer and Packagist.

This repo represents a snapshot of the PuPHPet project. It includes minimal tooling designed to fetch a copy of the PuPHPet release ZIP file and import it into this project. This project includes a composer.json file, making it possible to include puphpet in another target project using composer.

There are a still a number of things that need to happen. For those, see:

* https://github.com/loadsys/puphpet-release/issues/1
* https://github.com/puphpet/puphpet/issues/1320


## Requirements

* [composer](https://getcomposer.org/)
* [vagrant](https://www.vagrantup.com/)
* A project of your own in which you'd like to use PuPHPet via composer.


## Installation

Run the following command to include the vagrant environment provided by PuPHPet in your project:

```shell
php composer.phar require --dev loadsys/puphpet-release:1.0.*
```


## Usage

Once you've included the package as instructed above, you should be able to run vagrant with the default configuration immediately:

```shell
vagrant up
```

### Customizing

To customize the vagrant box, you have two choices:

* Copy the default `/puphpet/config.yaml` file provided to `/puphpet.yaml` and edit it to suit your needs.When an existing `/puphpet.yaml` file is located in your project, it will be copied to `/puphpet/config.yaml` for this package to use.

* You can generate an appropriate `config.yaml` file using the puphpet.com web interface. Once you download the resulting `puphpet.zip` file, take **just** the `puphpet/config.yaml` file and save it into your project as `puphpet.yaml`.

In either case, your `puphpet.yaml` file should be committed to your own project's source control system so the vagrant virtual machine remains identical for all developers on the project.


@TODO: What about files and exec-* scripts?


### Composer Hook Scripts

When this package is included in another project via composer, a number of hook scripts fire in order to address some of the incompatibilities between puphpet's default setup and the requirements for Vagrant (such as the `Vagrantfile` living in the project's root directory instead of the composer-installed `/vendors/loadsys/puphpet-release/release/` folder.)

Some of the problems with this are as yet unsolved, in fact. @TODO: Explain, and/or resolve.

* Getting Vagrantfile into project root. How do we update it during `composer update`?
* Getting puphpet/ folder into project root. How do we update? What if there are customizations to files/ or exec-*/ folders?
* Getting the project's config.yaml into the correct place.
* Validating that the target project's config.yaml file has all expected (mandatory) keys as the spec changes upstream. Can we write/maintain a "unit test" and/or diffing tool for it? It's just YAML after all.


### Running the release scraper

This project includes a shell script designed to fetch the latest puphpet.zip file from puphpet.com, unpack it, and commit it back into this repo.

```shell
git clone git@github.com:loadsys/puphpet-release.git
cd puphpet-release
bin/scrape-release.sh
```

This script is intended be scheduled to run via cron to update the repo periodically. It must be run from a clone of the remote repo that Packagist is aware of.

Packagist expects semantic versioning, and this presents a challenge. The puphpet.com project [does not conform to semver](https://github.com/puphpet/puphpet/issues/777#issuecomment-51832044) and the project makes backwards-incompatible changes frequently. To work around this, the release script automatically tags each new version using a minor number. This allows consuming projects to target a specific point release that will auto-update in a breaking way. The consequence is that consuming projects **must** manually update their targeted version and verify it is still operational for their needs.


## Contributing

@TODO


## License

MIT. In particular, all PuPHPet work belongs to the original authors. This project is strictly for our own convenience.


## Copyright

&copy; [Loadsys Web Strategies](http://loadsys.com) 2015
